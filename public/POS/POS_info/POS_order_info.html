<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBzWGqNmb6KazuZB_ykjg1zkS-YWSaFFBk",
            authDomain: "store-reservation-system.firebaseapp.com",
            projectId: "store-reservation-system",
            storageBucket: "store-reservation-system.appspot.com",
            messagingSenderId: "734537126957",
            appId: "1:734537126957:web:5d84d462476d77ddbbd4a4"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    <title>주문 내역</title>
</head>

<body>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel" data-bs-scroll="true">
        <div class="offcanvas-header">
            <h5 id="offcanvasRightLabel"></h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div id="offcanvas-body" class="offcanvas-body"></div>
    </div>
    <div class="container">주문 내역</div>

    <script>
        var table_num
        const db = firebase.firestore();
        var myOffcanvas = document.getElementById('offcanvasRight')
        var myButton = document.getElementById('table');
        var table_btn = document.getElementsByClassName(".table_btn");
        var total = 0;

        function initApp(){   
            db.collection("테스트").get().then((result) => {
                result.forEach((doc) => {
                    table_num = doc.data().테이블갯수;
                })
                for(let i=1; i<=table_num; i++){
                var templete =`<button id=${i} class="table_btn">${i}번 테이블</button>`
                $(".container").append(templete);
            }
            }).catch((err) => {
                console.log(err);
            })           
        }

        function get_order_list(data){
            db.collection("테스트").doc("test").collection("테이블정보").doc(String(data)).collection("주문정보").get().then((result) => {
                result.forEach((doc) => {
                    //len = doc.data().주문.length;
                    doc.data().주문.forEach((arr)=>{
                        console.log(arr);
                        var body_templete =
                            `<div>제품명 : ${arr.제품명}</div>
                            <div>가격 : ${arr.가격}</div>
                            <div>수량 : ${arr.수량}</div>
                            <br>`
                        $(".offcanvas-body").append(body_templete);
                        total = total + (arr.가격 * arr.수량);
                    })
                })
                $(".offcanvas-body").append(`<div>총 가격 : ${total}원</div>`);
            })
        }

        initApp();

        $(document).on("click", ".table_btn", function () {
            val = event.srcElement.id
            $("#offcanvasRightLabel").append(`<div>${val}번 테이블 주문내역</div>`);
            $("#offcanvasRight").offcanvas("show");
            get_order_list(val);
        })


        myOffcanvas.addEventListener('hidden.bs.offcanvas', function () {
            $("#offcanvasRightLabel").empty();
            $("#offcanvas-body").empty();
            total = 0;
            })

        document.getElementsByClassName("table_btn")
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>